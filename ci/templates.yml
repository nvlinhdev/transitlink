.ssh_setup: &ssh_setup
  before_script:
    - apk add --no-cache openssh
    - mkdir -p ~/.ssh
    - chmod 700 ~/.ssh
    - echo "$SSH_PRIVATE_KEY" > ~/.ssh/id_rsa
    - chmod 600 ~/.ssh/id_rsa
    - ssh-keyscan -H $HOST >> ~/.ssh/known_hosts
    - chmod 644 ~/.ssh/known_hosts

.test_artifacts: &test_artifacts
  when: always
  reports:
    junit:
      - build/test-results/*/TEST-*.xml
  expire_in: 1 week

.gradle_template: &gradle_template
  image: gradle:${GRADLE_VERSION}
  before_script:
    - gradle --version

.docker_template: &docker_template
  image: docker:${DOCKER_VERSION}
  services:
    - docker:${DOCKER_VERSION}-dind
  variables:
    DOCKER_HOST: tcp://docker:2375
    DOCKER_TLS_CERTDIR: ""

.alpine_template: &alpine_template
  image: alpine:${ALPINE_VERSION}
  <<: *ssh_setup

.curl_template: &curl_template
  image: curlimages/curl:$CURL_VERSION
  before_script:
    - apk add --no-cache jq

.retry_config: &retry_config
  retry:
    max: 2
    when:
      - runner_system_failure
      - stuck_or_timeout_failure