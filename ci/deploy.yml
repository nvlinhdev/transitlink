deploy:
  stage: deploy
  <<: *alpine_template
  <<: *rules_main_only
  needs:
    - job: backup_app_db
      artifacts: false
    - job: backup_keycloak_db
      artifacts: false
    - job: backup_transitlink_data
      artifacts: false
  script:
    - ssh $USER@$HOST "mkdir -p $BACKUPS_DIR/api"
    - chmod +x scripts/deploy/deploy.sh
    - ./scripts/deploy/deploy.sh

rollback:
  stage: deploy
  <<: *alpine_template
  <<: *rules_main_manual
  variables:
    ROLLBACK_TAG: ""
  script:
    - chmod +x scripts/deploy/rollback.sh
    - ./scripts/deploy/rollback.sh