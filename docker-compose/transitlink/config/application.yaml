server:
  port: ${TRANSITLINK_PORT:8888}

spring:
  jackson:
    time-zone: UTC

  datasource:
    url: jdbc:postgresql://${TRANSITLINK_DB_HOST}:${TRANSITLINK_DB_PORT}/${TRANSITLINK_DB_NAME}
    username: ${TRANSITLINK_DB_USER}
    password: ${TRANSITLINK_DB_PASSWORD}
    driver-class-name: org.postgresql.Driver
    hikari:
      pool-name: HikariPool-TransitLink
      connection-init-sql: "SET time zone 'UTC';"
      maximum-pool-size: 20
      minimum-idle: 5
      idle-timeout: 60000
      connection-timeout: 3000
      max-lifetime: 1800000

  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    open-in-view: false
    properties:
      hibernate.format_sql: true
      hibernate.dialect: org.hibernate.dialect.PostgreSQLDialect
      hibernate.jdbc.time_zone: UTC
      hibernate.jdbc.batch_size: 50
      hibernate.order_inserts: true
      hibernate.order_updates: true

  data:
    redis:
      host: ${REDIS_HOST}
      port: ${REDIS_PORT}
      password: ${REDIS_PASSWORD}

  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: ${KEYCLOAK_SCHEMA:"http"}://${KEYCLOAK_DOMAIN}/realms/${KEYCLOAK_REALM:"transitlink"}
          jwk-set-uri: ${KEYCLOAK_SCHEMA:"http"}://${KEYCLOAK_DOMAIN}/realms/${KEYCLOAK_REALM:"transitlink"}/protocol/openid-connect/certs

  servlet:
    multipart:
      max-file-size: ${TRANSITLINK_MAX_FILE_SIZE:"50MB"}
      max-request-size: ${TRANSITLINK_MAX_REQUEST_SIZE:"50MB"}

management:
  endpoints:
    web:
      exposure:
        include: "health,info"
  endpoint:
    health:
      probes:
        enabled: true

logging:
  file:
    name: ${TRANSITLINK_WORKING_DIR:"."}/logs/transitlink.log
  logback:
    rollingpolicy:
      max-file-size: ${TRANSITLINK_MAX_LOG_FILE_SIZE:10MB}
      max-history: ${TRANSITLINK_MAX_LOG_HISTORY:7}

app:
  storage:
    provider: ${TRANSITLINK_STORAGE_PROVIDER:"local"}
    root-path: ${TRANSITLINK_WORKING_DIR:"."}/data
    base-url: ${TRANSITLINK_SCHEMA}://${TRANSITLINK_DOMAIN}/files
  security:
    permit-all:
      - /swagger-ui/**
      - /v3/api-docs/**
      - /swagger-ui.html
      - /files/**
      - /actuator/health
      - /actuator/info
    cors:
      allowed-origins:
        - "http://localhost:4200"
        - "http://localhost:8888"
        - "http://api.transitlink.fpt.edu.vn"
        - "https://api.transitlink.fpt.edu.vn"
      allowed-methods:
        - GET
        - POST
        - PUT
        - DELETE
        - OPTIONS
      allowed-headers:
        - "*"
      allow-credentials: true

# SpringDoc configuration for API documentation
springdoc:
  api-docs:
    enabled: true # change false to disable API docs on production

  swagger-ui:
    enabled: true # change false to disable Swagger UI on production

    # when api-doc and swagger-ui are disabled, all of these properties can be ignored
    oauth:
      client-id: web-app
      use-pkce-with-authorization-code-grant: true

  info:
    title: TransitLink API
    version: 1.0.0
    description: API documentation for the TransitLink application

  servers:
    - url: http://localhost:8888
      description: Local development server
    - url: http://api.transitlink.fpt.edu.vn
      description: Containerized depvloyment server

  oauth:
    authorization-url: ${KEYCLOAK_SCHEMA:"http"}://${KEYCLOAK_DOMAIN}/realms/${KEYCLOAK_REALM:"transitlink"}/protocol/openid-connect/auth
    token-url: ${KEYCLOAK_SCHEMA:"http"}://${KEYCLOAK_DOMAIN}/realms/${KEYCLOAK_REALM:"transitlink"}/protocol/openid-connect/token
    refresh-url: ${KEYCLOAK_SCHEMA:"http"}://${KEYCLOAK_DOMAIN}/realms/${KEYCLOAK_REALM:"transitlink"}/protocol/openid-connect/token
    scopes:
      openid: OpenID scope
      email: User email
      offline_access: Offline access (refresh token)

  groups:
    - group: profile
      paths: /api/profiles/**
    - group: storage
      paths: /api/storage/**